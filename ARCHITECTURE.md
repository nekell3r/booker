# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã Booker

## –û–±–∑–æ—Ä

Booker - —ç—Ç–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–æ–ª–æ–≤, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –Ω–∞ Go —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º gRPC, Kafka, Redis –∏ PostgreSQL.

## –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤

### 1. Admin Gateway (`admin-gateway`)
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- **REST API —à–ª—é–∑** - –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **API Gateway Pattern** - –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç REST –∑–∞–ø—Ä–æ—Å—ã –≤ gRPC –≤—ã–∑–æ–≤—ã –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (JWT)
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (–≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
- WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Echo (HTTP framework)
- gRPC –∫–ª–∏–µ–Ω—Ç—ã –¥–ª—è venue-svc –∏ booking-svc
- Redis –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å–µ—Å—Å–∏–π

**–ü–æ—Ä—Ç:** 8080 (HTTP)

**–í–∞–∂–Ω–æ**: –≠—Ç–æ **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–±** —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–æ–π –∏–∑–≤–Ω–µ. `venue-svc` –∏ `booking-svc` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ gRPC —Å–µ—Ä–≤–∏—Å—ã, –Ω–µ –∏–º–µ—é—Ç REST API.

**–î–æ—Å—Ç—É–ø**: http://localhost:8080/api/v1/...

üìñ **–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ API**: [API_USAGE.md](API_USAGE.md)

---

### 2. Venue Service (`venue-svc`)
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è–º–∏ (venues)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ª–∞–º–∏ (rooms)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–ª–∞–º–∏ (tables)
- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –∑–∞–≤–µ–¥–µ–Ω–∏–π (opening hours, special hours)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å—Ç–æ–ª–æ–≤ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- gRPC —Å–µ—Ä–≤–µ—Ä
- PostgreSQL (—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –ë–î)
- Redis –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- Kafka –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π

**–ü–æ—Ä—Ç—ã:**
- 50051 (gRPC)
- 9091 (Prometheus metrics)

**–û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**
- CRUD –¥–ª—è venues, rooms, tables
- `CheckAvailability` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å—Ç–æ–ª–æ–≤
- `GetTableLayout` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ö–µ–º—ã –∑–∞–ª–∞
- `SetOpeningHours` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

---

### 3. Booking Service (`booking-svc`)
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- –ú–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π (held ‚Üí confirmed ‚Üí seated ‚Üí finished)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏ (holds) —á–µ—Ä–µ–∑ Redis
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è—Ö
- Outbox pattern –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- gRPC —Å–µ—Ä–≤–µ—Ä
- PostgreSQL (—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –ë–î)
- Redis –¥–ª—è holds (–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)
- Kafka –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π
- gRPC –∫–ª–∏–µ–Ω—Ç –¥–ª—è venue-svc

**–ü–æ—Ä—Ç—ã:**
- 50052 (gRPC)
- 9092 (Prometheus metrics)

**–û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**
- `CreateBooking` - —Å–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (—Å hold)
- `ConfirmBooking` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `CancelBooking` - –æ—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `MarkSeated` - –æ—Ç–º–µ—Ç–∫–∞ –æ –ø–æ—Å–∞–¥–∫–µ –≥–æ—Å—Ç–µ–π
- `MarkFinished` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `MarkNoShow` - –æ—Ç–º–µ—Ç–∫–∞ –æ –Ω–µ—è–≤–∫–µ

**–°–æ—Å—Ç–æ—è–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:**
```
requested ‚Üí held ‚Üí confirmed ‚Üí seated ‚Üí finished
                ‚Üì
            cancelled/expired/no_show
```

**Workers:**
- Outbox worker - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –≤ Kafka
- Expired holds worker - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

---

### 4. Notify Service (`notify-svc`)
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –∏–∑ Kafka
- –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (email, SMS, push)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –∏ –∑–∞–≤–µ–¥–µ–Ω–∏–π

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Kafka consumer
- gRPC (–¥–ª—è –±—É–¥—É—â–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π)

**–û—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è:**
- `booking.held` - —Å–æ–∑–¥–∞–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- `booking.confirmed` - –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ
- `booking.cancelled` - –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ
- `booking.seated` - –≥–æ—Å—Ç–∏ —Å–µ–ª–∏ –∑–∞ —Å—Ç–æ–ª
- `booking.finished` - –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
- `venue.schedule.updated` - –æ–±–Ω–æ–≤–ª–µ–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ

---

## –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

### –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

```
1. –ö–ª–∏–µ–Ω—Ç ‚Üí Admin Gateway (REST POST /api/v1/bookings)
2. Admin Gateway ‚Üí Booking Service (gRPC CreateBooking)
3. Booking Service ‚Üí Venue Service (gRPC CheckAvailability)
4. Booking Service ‚Üí Redis (SetHold - –≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
5. Booking Service ‚Üí PostgreSQL (CreateBooking)
6. Booking Service ‚Üí Outbox (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è)
7. Outbox Worker ‚Üí Kafka (–ø—É–±–ª–∏–∫–∞—Ü–∏—è booking.held)
8. Notify Service ‚Üí Kafka (–ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è)
9. Notify Service ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç—É
```

### –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

```
1. –ö–ª–∏–µ–Ω—Ç ‚Üí Admin Gateway (REST POST /api/v1/bookings/:id/confirm)
2. Admin Gateway ‚Üí Booking Service (gRPC ConfirmBooking)
3. Booking Service ‚Üí PostgreSQL (UpdateBookingStatus)
4. Booking Service ‚Üí Redis (DeleteHold - —Å–Ω—è—Ç–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)
5. Booking Service ‚Üí Outbox (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è)
6. Outbox Worker ‚Üí Kafka (–ø—É–±–ª–∏–∫–∞—Ü–∏—è booking.confirmed)
7. Notify Service ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```

## –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### PostgreSQL
- **venue-svc**: –ë–î `venue` - –∑–∞–≤–µ–¥–µ–Ω–∏—è, –∑–∞–ª—ã, —Å—Ç–æ–ª—ã, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
- **booking-svc**: –ë–î `booking` - –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, outbox –¥–ª—è —Å–æ–±—ã—Ç–∏–π

### Redis
- **Holds**: –í—Ä–µ–º–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å—Ç–æ–ª–æ–≤ (`hold:venue_id:table_id:date:time`)
- **–ö–µ—à**: –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ–¥–µ–Ω–∏–π –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- **Sentinel**: –í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Redis (1 master + 2 replicas + 1 sentinel)

## –°–æ–±—ã—Ç–∏—è (Kafka)

### Booking Events
- `booking.held` - —Å–æ–∑–¥–∞–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- `booking.confirmed` - –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ
- `booking.cancelled` - –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ
- `booking.seated` - –≥–æ—Å—Ç–∏ —Å–µ–ª–∏ –∑–∞ —Å—Ç–æ–ª
- `booking.finished` - –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
- `booking.expired` - –∏—Å—Ç–µ–∫–ª–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- `booking.no_show` - –≥–æ—Å—Ç–∏ –Ω–µ —è–≤–∏–ª–∏—Å—å

### Venue Events
- `venue.schedule.updated` - –æ–±–Ω–æ–≤–ª–µ–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
- `table.layout.updated` - –∏–∑–º–µ–Ω–µ–Ω–∞ —Å—Ö–µ–º–∞ —Å—Ç–æ–ª–æ–≤

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏
- **HTTP –º–µ—Ç—Ä–∏–∫–∏**: `admin-gateway` (requests_total, request_duration)
- **gRPC –º–µ—Ç—Ä–∏–∫–∏**: `venue-svc`, `booking-svc` (grpc_server_requests_total, grpc_server_request_duration)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **Kafka**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- **Redis**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π

### –î–∞—à–±–æ—Ä–¥—ã
- Grafana: http://localhost:3000
- Prometheus: http://localhost:9090
- Jaeger: http://localhost:16686 (—Ç—Ä–µ–π—Å–∏–Ω–≥)

## –ü—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**: –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é –¥–æ–º–µ–Ω–Ω—É—é –æ–±–ª–∞—Å—Ç—å
2. **–ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –ë–î**: –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –∏–º–µ–µ—Ç —Å–≤–æ—é –ë–î
3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è**: –°–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ Kafka
4. **Outbox Pattern**: –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π
5. **Holds Pattern**: –í—Ä–µ–º–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —á–µ—Ä–µ–∑ Redis
6. **Circuit Breaker**: –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö —Å–±–æ–µ–≤ (–±—É–¥—É—â–µ–µ)
7. **Retry & Idempotency**: –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑–æ–ø–∞—Å–Ω—ã

## –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

- **Admin Gateway**: –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (stateless)
- **Venue Service**: –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (read-heavy)
- **Booking Service**: –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (write-heavy, —Ç—Ä–µ–±—É–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏)
- **Notify Service**: –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (consumer groups)

